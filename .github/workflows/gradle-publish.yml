name: Build Gradle Projects

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Set up JDK 21
      uses: actions/setup-java@v2
      with:
        java-version: '21'

    - name: Find Gradle projects
      id: find_projects
      run: |
        echo "::set-output name=projects::$(find ${{ github.workspace }}/Services -mindepth 1 -maxdepth 1 -type d)"

    - name: Setup Gradle
      uses: gradle/setup-gradle@v1
      with:
        distribution-url: wrapper

    - name: Build with Gradle
      run: |
        for project in ${{ steps.find_projects.outputs.projects }}; do
          echo "Building $project"
          cd $project
          ./gradlew build
          cd -
        done
